import{d as g,n as c}from"./entry.98dfd619.js";import{f as s}from"./FetchInstance.12311bd0.js";const n="/gio-hang",l=t=>s.post(`${n}`,t),h=t=>s.del(`${n}/remove-item/${t}`),m=()=>s.del(`${n}/gio-hang-cua-toi`),d=t=>s.post(`${n}/dong-bo-gio-hang`,t),o={addProduct:l,removeProduct:h,syncCart:d,myCart:m},f=g("cart",{state:()=>{let t=[];if(!localStorage.getItem("cart"))localStorage.setItem("cart",JSON.stringify([]));else try{let e=localStorage.getItem("cart");t=e?JSON.parse(e):[]}catch{}return{cart:t}},actions:{addToCart(t){console.log("cart store-add: ",t,this),this.fAddToCart(t)},async fAddToCart(t){console.log("begin add item",t);try{localStorage.getItem("loggedUser")&&await o.addProduct({sanPhamBienThe:t.id,soLuong:t.qty}),t.isTurnOffShowRs||c.success({message:"Thêm thành công!"});const e=this.cart.find(r=>r.id===t.id);if(e){if(e.qty==t.stockCnt)return;this.cart.forEach(r=>{r.id==e.id&&(r.qty=t.qty+r.qty)})}else this.cart.push({id:t.id,qty:t.qty,anh:t.anh,productId:t.productId,productName:t.productName,price:t.price,variation:t.variation,stockCnt:t.stockCnt});i(this.cart)}catch(e){console.log("user.add cart failed: ",e),c.error({message:"Thêm sản phẩm thất bại!"})}},async updateCartQuantity(t){try{localStorage.getItem("loggedUser")&&await o.addProduct({sanPhamBienThe:t.id,soLuong:t.qty}),this.fUpdateCartQuantity(t)}catch(e){console.log("user.add cart failed: ",e),c.error({message:"Không thể cập nhật giỏ hàng!"})}},fUpdateCartQuantity(t){const e=this.cart.map(r=>(r.id==t.id&&(r.qty=t.qty),r));this.cart=e,i(e)},async removeCartItem(t){try{localStorage.getItem("loggedUser")&&await o.removeProduct(t),this.fRemoveCartItem(t)}catch(e){console.log("failed to remove cart item",e)}},fRemoveCartItem(t){this.cart=this.cart.filter(e=>e.id!=t),i(this.cart),c.success({message:"Xoá thành công!"})},fSetCart(t){this.cart=t,localStorage.setItem("cart",JSON.stringify([]))},fSetBuyNow(t){this.variationNow=t}},getters:{cartItems:t=>t.cart,cartTotalQty(t){return t.cart.reduce((e,r)=>e+r.qty,0)},cartTotalAmount(t){return t.cart.reduce((e,r)=>e+r.price*r.qty,0)}}}),i=t=>{localStorage.getItem("loggedUser")||localStorage.setItem("cart",JSON.stringify(t))},C=()=>{const t=f();console.log("sync cart begin",t);let e;if(localStorage.getItem("cart")&&localStorage.getItem("loggedUser")){let r=localStorage.getItem("cart");e=r?JSON.parse(r):[],o.syncCart(e.map(a=>({sanPhamBienThe:a.id,soLuong:a.qty}))).then(a=>{t.fSetCart(a),console.log("data cart: ",a),localStorage.removeItem("cart")}),console.log("cart local: ",e)}else localStorage.getItem("loggedUser")&&o.myCart().then(r=>{t.fSetCart(r),console.log("my cart: ",r)})};export{C as s,f as u};
