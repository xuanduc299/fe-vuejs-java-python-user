import{u as re,n as M}from"./entry.98dfd619.js";import{P as ue}from"./PaymentService.5f7c0cf5.js";import{u as ce}from"./cart.caca9891.js";import{P as de}from"./ProductService.87d523f1.js";import{B as he,_ as pe}from"./index.7b78a5c4.js";import{C as me}from"./index.be0ec20f.js";import{_ as _e}from"./index.3fdac0c6.js";import{I as ge}from"./Password.0211d37f.js";import{B as fe}from"./index.42b56407.js";import{S as ve,a as Te}from"./index.56ca7c7d.js";import{F as Ce}from"./index.03c13174.js";import{R as Ne,_ as ye}from"./index.4c10a40d.js";import{M as Ie}from"./index.3b7226f8.js";import{_ as we}from"./index.29383fe5.js";import{d as xe,i as q,a as b,r as Y,c as be,J as Pe,a7 as ke,a0 as C,D as a,R as n,U as l,P as m,a2 as d,u as h,ab as E,F as D,aa as O,Q as F,a1 as p}from"./swiper-vue.a421f1cd.js";import{_ as Se}from"./index.833c360b.js";import{_ as Ee}from"./FormItem.aab759e1.js";import{_ as De}from"./index.bde236d0.js";import"./FetchInstance.12311bd0.js";import"./dropdown.3b7ba1b5.js";import"./index.6d00dcf5.js";import"./index.a68a0920.js";import"./KeyCode.6e31e5e1.js";import"./zoom.cba4073c.js";import"./ResizeObserver.es.0f9f8adb.js";import"./collapseMotion.f1f8d61b.js";import"./index.f15daada.js";import"./index.73bdfe75.js";import"./useRefs.ffce2853.js";import"./hasIn.fd17fd00.js";import"./isSymbol.28713955.js";import"./isMobile.358fd6c2.js";import"./useMergedState.8fbbbf27.js";import"./styleChecker.29229325.js";import"./EyeOutlined.deffa0c0.js";import"./SearchOutlined.4ca08eb4.js";import"./LeftOutlined.b7f52e0f.js";import"./pickAttrs.aaf4be5e.js";import"./debounce.ff103b05.js";import"./index.deae0fdd.js";import"./fade.dee7eb07.js";import"./eagerComputed.a5367e69.js";import"./css.faa01186.js";import"./index.7a7f2286.js";import"./index.ea786c70.js";import"./scrollTo.aaa727bd.js";import"./useFlexGapSupport.d9dc3cd0.js";const Ve={class:"px-3 md:px-[50px] w-full"},Re={class:"w-full flex gap-[30px] mt-[30px]"},Ae=l("h3",{class:"text-2xl",style:{"border-bottom":"2px solid orange"}}," Thông Tin Mua Hàng ",-1);const He=l("h3",{class:"text-2xl",style:{"border-bottom":"2px solid orange"}}," Thông Tin Đơn Hàng ",-1),qe={class:"m-0"},Oe={class:"m-0"},Fe={key:1},Ue={key:2},$e=l("span",{class:"font-semibold"}," Tổng tiền sản phẩm ",-1),Be=l("span",{class:"font-semibold"}," Phí ship ",-1),Ge=l("span",{class:"font-semibold"}," Giảm giá ",-1),Le={class:"grid"},je={class:"mt-[20px]"},Me=l("div",null,[l("h4",{class:"font-[700] m-0"},"Mã SJSHNS"),l("span",null," Giảm 100k nhân dịp giáng sinh ")],-1),Ye={class:"flex justify-center"},ze={key:0,class:"text-end text-red-500"},We={key:1,class:"text-end text-green-500"},Je=l("span",{class:"font-semibold"}," Tổng tiền thanh toán ",-1),Qe={class:"text-red-500"},Ze=l("span",{class:"font-semibold"}," Chọn hình thức thanh toán ",-1),Yt=xe({__name:"index",setup(Xe){const V=q("removeSpecialChars",i=>i),U=q("getProvinces",i=>[]),y=q("formatVnCurrency",i=>0),u=ce(),z=re(),P=b(),W=()=>{var i;(i=P==null?void 0:P.value)==null||i.validate().then(()=>{X(e)}).catch(t=>{K(t)})},J=[{title:"Sản phẩm",className:"product",dataIndex:"product",align:"center"},{title:"Giá",dataIndex:"price",align:"center"},{title:"Tổng",dataIndex:"qty",align:"center"}],e=Y({phanLoaidIds:[],diaChiNhanHang:"",hoTenNguoiNhan:"",soDienThoaiNhanHang:"",note:"",phuongThucTT:"VNPAY",discount:0,shipFee:0,province:"",district:"",ward:"",totalPay:0}),s=Y({hasChecked:!1,isValid:!1,isChecking:!1,error:"",success:"",voucherInfo:void 0,q:"",discountPrice:0}),$=()=>{if(!s.isChecking)if(s.hasChecked=!0,s.discountPrice=0,s.voucherInfo=void 0,!s.q)s.isValid=!1,s.error="Vui lòng nhập mã code giảm giá!";else{s.isChecking=!0;const i=[];new Set(u.cart.map(t=>t.productId)).forEach(t=>{i.push(t)}),de.checkVoucher(s.q,i).then(t=>{if(s.voucherInfo=t,s.isValid=!0,console.log("voucher info: ",t),t.giamGiaTheo=="PERCENT"){const r=u.cartTotalAmount*(t.phanTramGiam/100);s.success="Áp mã thành công, bạn được giảm "+y(r),s.discountPrice=r}else s.success="Áp mã thành công, bạn được giảm "+y(t.giaGiam),s.discountPrice=t.giaGiam}).catch(t=>{console.log("check voucher failed: ",t.response.status),s.isValid=!1,t.response.status==404?s.error="Rất tiếc, mã giảm giá không tồn tại!":s.error="Rất tiếc, sản phẩm của bạn không phù hợp với mã giảm này!"}).finally(()=>s.isChecking=!1)}},Q=(i,t)=>t?t&&!/((09|03|07|08|05)+([0-9]{8})\b)/g.test(t)?Promise.reject("Số điện thoại không đúng!"):Promise.resolve():Promise.reject("Vui lòng không bỏ trống!"),Z=(i,t)=>t&&!/^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/g.test(t)?Promise.reject("Email không hợp lệ!"):Promise.resolve(),R=b([]),k=b([]),S=b([]),B=()=>{if(k.value=[],S.value=[],e.district="",e.ward="",e.province.split("##").length==2){const i=U({p:e.province.split("##")[0]});k.value=i[0].districts,console.log("on province change: ",i[0])}},G=()=>{if(S.value=[],e.ward="",e.district.split("##").length==2){const i=k.value.filter(t=>e.district.split("##")[0]==t.DISTRICT_ID);S.value=i[0].wards,console.log("on district change: ",i[0])}te()},L=b(),A=b(!1),X=i=>{var r;if(console.log("Success:",i),A.value)return;A.value=!0;const t={email:e.email,phuongThucTT:e.phuongThucTT,note:e.note,hoTenNguoiNhan:e.hoTenNguoiNhan,soDienThoaiNhanHang:e.soDienThoaiNhanHang,diaChiNhanHang:void 0,diaChiId:void 0,maGiamGiaId:((r=s==null?void 0:s.voucherInfo)==null?void 0:r.id)||void 0,shipFee:e.shipFee,totalPay:e.totalPay};L.value?t.diaChiId=L.value:t.diaChiNhanHang=`${e.diaChiNhanHang}__${e.ward}__${e.district}__${e.province}`,u.variationNow?t.gioHangTamThoiReqDto=[{sanPhamBienThe:u.variationNow.id,soLuong:u.variationNow.qty}]:t.gioHangTamThoiReqDto=u.cart.map(c=>({sanPhamBienThe:c.id,soLuong:c.qty})),console.log("order payload: ",t),ue.checkout(t).then(c=>{const f=c;console.log("data hang ok:",c),localStorage.setItem("lastAddress",t.diaChiNhanHang),localStorage.setItem("lastOrderReceipent",e.hoTenNguoiNhan),localStorage.setItem("lastOrderPhone",e.soDienThoaiNhanHang),localStorage.setItem("lastOrderEmail",e.email||""),e.phuongThucTT=="VNPAY"?location.replace(f.urlPay):z.push("/dat-hang/ket-qua?status=SUCCESS&id="+f.id)}).catch(c=>{var f,v,_,I,T,w;console.log("checkout failed: ",(v=(f=c.response)==null?void 0:f._data)==null?void 0:v.code),M.error({message:"Đặt hàng thất bại. "+(((I=(_=c.response)==null?void 0:_._data)==null?void 0:I.code)!=9999?(w=(T=c.response)==null?void 0:T._data)==null?void 0:w.message:"")})}).finally(()=>A.value=!1)},K=i=>{console.log("Failed:",i),M.error({message:"Vui lòng kiểm tra lại thông tin!"})},ee=be(()=>(u.variationNow?e.totalPay=u.variationNow.qty*u.variationNow.price+e.shipFee-s.discountPrice:e.totalPay=u.cartTotalAmount+e.shipFee-s.discountPrice,e.totalPay)),te=()=>{const t={SENDER_PROVINCE:1,SENDER_DISTRICT:1,RECEIVER_PROVINCE:Number(e.province.split("##")[0]),RECEIVER_DISTRICT:Number(e.district.split("##")[0]),PRODUCT_TYPE:"HH",PRODUCT_WEIGHT:u.variationNow?u.variationNow.qty*400:u.cartTotalQty*400,PRODUCT_PRICE:0,MONEY_COLLECTION:0,TYPE:1};fetch("https://api.viettelpost.vn/api/tmdt/getPriceAll",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),redirect:"follow"}).then(r=>r.json()).then(r=>{r=r.sort((c,f)=>c.GIA_CUOC-f.GIA_CUOC),console.log(r),r.length==0||(e.shipFee=Math.ceil((r[0].GIA_CUOC+6e3)/1e3)*1e3)}).catch(r=>{console.log("error",r),e.shipFee=3e4})};return Pe(()=>{if(R.value=U({p:void 0}),console.log("dat hang page mounted: ",R.value),localStorage.getItem("lastAddress")){try{const i=String(localStorage.getItem("lastAddress")).split("__");console.log("last add: ",i),e.diaChiNhanHang=i[0],e.province=i[3],B(),e.district=i[2],G(),e.ward=i[1]}catch(i){console.log(i)}e.hoTenNguoiNhan=localStorage.getItem("lastOrderReceipent")||"",e.soDienThoaiNhanHang=localStorage.getItem("lastOrderPhone")||"",e.email=localStorage.getItem("lastOrderEmail")||""}}),(i,t)=>{const r=ke("router-link"),c=pe,f=he,v=ge,_=Ee,I=fe,T=ve,w=Te,ae=_e,ne=Ce,j=me,g=Se,H=Ne,oe=De,se=Ie,ie=ye,le=we;return m(),C("div",Ve,[a(f,{class:"bg-gray-50 p-2"},{default:n(()=>[a(c,null,{default:n(()=>[a(r,{to:"/"},{default:n(()=>[d("Trang chủ")]),_:1})]),_:1}),a(c,null,{default:n(()=>[d("Đặt hàng")]),_:1}),a(c,null,{default:n(()=>[d("Điền thông tin đặt hàng")]),_:1})]),_:1}),l("div",Re,[a(j,{class:"w-[50%] shadow-sm"},{title:n(()=>[Ae]),default:n(()=>[a(ne,{ref_key:"formRef",ref:P,model:e,"label-col":{span:8}},{default:n(()=>[a(_,{label:"Tên người nhận",name:"hoTenNguoiNhan",rules:[{required:!0,message:"Vui lòng không được bỏ trống!"}]},{default:n(()=>[a(v,{value:e.hoTenNguoiNhan,"onUpdate:value":t[0]||(t[0]=o=>e.hoTenNguoiNhan=o),onChange:t[1]||(t[1]=o=>e.hoTenNguoiNhan=h(V)(e.hoTenNguoiNhan).replace(/^\s+/,""))},null,8,["value"])]),_:1}),a(_,{label:"Số điện thoại",name:"soDienThoaiNhanHang",rules:[{required:!0,validator:Q}]},{default:n(()=>[a(v,{value:e.soDienThoaiNhanHang,"onUpdate:value":t[2]||(t[2]=o=>e.soDienThoaiNhanHang=o),onChange:t[3]||(t[3]=o=>e.soDienThoaiNhanHang=e.soDienThoaiNhanHang.replace(/[^0-9@]/g,"")),maxLength:10},null,8,["value"])]),_:1},8,["rules"]),a(_,{label:"Địa chỉ email",name:"email",rules:[{validator:Z}]},{default:n(()=>[a(v,{value:e.email,"onUpdate:value":t[4]||(t[4]=o=>e.email=o),maxLength:255,onChange:t[5]||(t[5]=o=>e.email=e.email.replace(/^\s+/,"")),type:"email"},null,8,["value"])]),_:1},8,["rules"]),E("",!0),a(_,{label:"Tỉnh/TP",name:"province",rules:[{required:!0,message:"Vui lòng chọn tỉnh/TP!"}]},{default:n(()=>[a(w,{value:e.province,"onUpdate:value":t[6]||(t[6]=o=>e.province=o),"show-search":"",class:"w-full min-w-[200px]",placeholder:"Chọn tỉnh/tp",style:{width:"100%"},onChange:B},{default:n(()=>[a(T,{value:""},{default:n(()=>[d("Chọn tỉnh/tp")]),_:1}),(m(!0),C(D,null,O(R.value,(o,x)=>(m(),F(T,{key:x,value:`${o.PROVINCE_ID}##${o.PROVINCE_NAME}`},{default:n(()=>[d(p(o.PROVINCE_NAME),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),a(_,{label:"Quận/Huyện",name:"district",rules:[{required:!0,message:"Vui lòng chọn quận/huyện!"}]},{default:n(()=>[a(w,{value:e.district,"onUpdate:value":t[7]||(t[7]=o=>e.district=o),"show-search":"",placeholder:"Chọn quận/huyện",style:{width:"100%"},onChange:G},{default:n(()=>[a(T,{value:""},{default:n(()=>[d("Chọn quận/huyện")]),_:1}),(m(!0),C(D,null,O(k.value,(o,x)=>(m(),F(T,{key:x,value:`${o.DISTRICT_ID}##${o.DISTRICT_NAME}`},{default:n(()=>[d(p(o.DISTRICT_NAME),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),a(_,{label:"Phường/Xã",name:"ward",rules:[{required:!0,message:"Vui lòng chọn xã/phường!"}]},{default:n(()=>[a(w,{value:e.ward,"onUpdate:value":t[8]||(t[8]=o=>e.ward=o),"show-search":"",style:{width:"100%"}},{default:n(()=>[a(T,{value:""},{default:n(()=>[d("Chọn xã/phường")]),_:1}),(m(!0),C(D,null,O(S.value,(o,x)=>(m(),F(T,{key:x,value:`${o.WARDS_ID}##${o.WARDS_NAME}`},{default:n(()=>[d(p(o.WARDS_NAME),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),a(_,{label:"Số nhà",name:"diaChiNhanHang",rules:[{required:!0,message:"Vui lòng không được bỏ trống!"}]},{default:n(()=>[a(v,{value:e.diaChiNhanHang,"onUpdate:value":t[9]||(t[9]=o=>e.diaChiNhanHang=o),onChange:t[10]||(t[10]=o=>e.diaChiNhanHang=h(V)(e.diaChiNhanHang).replace(/^\s+/,""))},null,8,["value"])]),_:1}),a(_,{label:"Ghi chú cho shop",name:"note"},{default:n(()=>[a(ae,{value:e.note,"onUpdate:value":t[11]||(t[11]=o=>e.note=o),onChange:t[12]||(t[12]=o=>e.note=h(V)(e.note).replace(/^\s+/,"")),maxLength:255},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1}),a(g,{class:"w-[50%]",direction:"vertical"},{default:n(()=>[a(j,{class:"w-full shadow-sm"},{title:n(()=>[He]),default:n(()=>[a(le,{columns:J,"data-source":h(u).variationNow?[h(u).variationNow]:h(u).cart,pagination:!1},{bodyCell:n(({column:o,text:x,record:N})=>[o.dataIndex==="product"?(m(),C(D,{key:0},[a(r,{class:"m-0",to:`/san-pham/${N.productName}/${N.productId}`},{default:n(()=>[l("span",qe,p(N.productName),1)]),_:2},1032,["to"]),l("p",Oe,p(N.variation)+" - x"+p(N.qty),1)],64)):E("",!0),o.dataIndex==="price"?(m(),C("span",Fe,p(h(y)(N.price)),1)):E("",!0),o.dataIndex==="qty"?(m(),C("span",Ue,p(h(y)(N.price*N.qty)),1)):E("",!0)]),footer:n(()=>[a(g,{direction:"vertical",class:"w-full"},{default:n(()=>[a(g,{class:"justify-between w-full"},{default:n(()=>[$e,l("span",null,p(h(y)(h(u).cartTotalAmount)),1)]),_:1}),a(g,{class:"justify-between w-full"},{default:n(()=>[Be,l("span",null,p(h(y)(e.shipFee)),1)]),_:1}),a(g,{class:"justify-between w-full items-start"},{default:n(()=>[Ge,l("div",Le,[a(se,{open:!1,title:"Danh sách mã giảm giá",footer:null,closable:!1},{default:n(()=>[a(g,{class:"w-full mb-[15px]"},{default:n(()=>[a(v,{value:s.q,"onUpdate:value":t[13]||(t[13]=o=>s.q=o),class:"w-full",placeholder:"Nhập mã giảm giá"},null,8,["value"]),a(I,{disabled:s.q,onClick:$},{default:n(()=>[d("Áp dụng")]),_:1},8,["disabled"])]),_:1}),l("div",je,[a(g,{class:"items-center bordered w-full p-[15px] rounded-[4px] cursor-pointer"},{default:n(()=>[a(H),Me]),_:1}),a(oe)]),l("div",Ye,[a(I,{type:"primary"},{default:n(()=>[d(" Đồng ý ")]),_:1})])]),_:1}),a(g,null,{default:n(()=>[a(v,{class:"w-[100px]",style:{outline:"none !important"},value:s.q,"onUpdate:value":t[14]||(t[14]=o=>s.q=o),size:"small",placeholder:"Mã giảm giá"},null,8,["value"]),a(I,{size:"small",onClick:$},{default:n(()=>[d("Áp dụng")]),_:1})]),_:1}),s.hasChecked&&!s.isValid?(m(),C("span",ze,p(s.error),1)):(m(),C("span",We,p(s.success),1))])]),_:1}),a(g,{class:"justify-between w-full"},{default:n(()=>[Je,l("span",Qe,p(h(y)(h(ee))),1)]),_:1}),a(g,{class:"w-full",direction:"vertical"},{default:n(()=>[Ze,a(ie,{value:e.phuongThucTT,"onUpdate:value":t[15]||(t[15]=o=>e.phuongThucTT=o)},{default:n(()=>[a(H,{value:"VNPAY"},{default:n(()=>[d("Thanh toán qua VNPAY")]),_:1}),a(H,{value:"COD"},{default:n(()=>[d("Thanh toán khi nhận hàng")]),_:1})]),_:1},8,["value"])]),_:1}),a(g,{class:"justify-end w-full"},{default:n(()=>[a(I,{class:"bg-black text-white",onClick:W},{default:n(()=>[d(" Đặt hàng ")]),_:1})]),_:1})]),_:1})]),_:1},8,["data-source"])]),_:1})]),_:1})])])}}});export{Yt as default};
